<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebAR GPS Model Viewer</title>
  <!-- A-Frame for AR -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <!-- AR.js for geolocation -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  
  <style>
    body { margin: 0; overflow: hidden; }
    a-scene { width: 100%; height: 100vh; }
    
    #info {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.85);
      color: #fff;
      padding: 12px;
      border-radius: 6px;
      font-size: 12px;
      font-family: Arial;
      z-index: 10;
      max-width: 200px;
    }
    
    #info p { margin: 4px 0; }
    #info span { color: #0f0; font-weight: bold; }
    #status { margin-top: 8px; padding-top: 8px; border-top: 1px solid #666; font-size: 11px; }
  </style>
</head>
<body>
  <!-- Info Panel -->
  <div id="info">
    <p>üìç Lat: <span id="lat">--</span></p>
    <p>üìç Lon: <span id="lon">--</span></p>
    <p>üìè Dist: <span id="distance">--</span>m</p>
    <div id="status">Initializing...</div>
  </div>

  <!-- A-Frame AR Scene -->
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false;">
    
    <!-- GPS-Anchored Model (appears at target location) -->
    <a-entity id="modelContainer" gps-entity-place="latitude: 6.8206; longitude: 80.0390;">
      <a-model src="assets/logo2.glb" scale="1 1 1" animation="property: rotation; to: 0 360 0; loop: true; dur: 8000;"></a-model>
    </a-entity>

    <!-- Fallback Hiro Marker (for indoor testing) -->
    <a-marker preset="hiro">
      <a-model src="assets/logo2.glb" scale="0.5 0.5 0.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 8000;"></a-model>
    </a-marker>

    <!-- Camera -->
    <a-entity camera></a-entity>
    
  </a-scene>

  <script>
    // Configuration
    const TARGET_LAT = 6.8206;
    const TARGET_LON = 80.0390;
    const TRIGGER_RADIUS = 50; // meters

    const latEl = document.getElementById('lat');
    const lonEl = document.getElementById('lon');
    const distEl = document.getElementById('distance');
    const statusEl = document.getElementById('status');

    // Calculate distance between two GPS points (Haversine)
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const œÜ1 = (lat1 * Math.PI) / 180;
      const œÜ2 = (lat2 * Math.PI) / 180;
      const ŒîœÜ = ((lat2 - lat1) * Math.PI) / 180;
      const ŒîŒª = ((lon2 - lon1) * Math.PI) / 180;
      const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // Update UI display
    function updateDisplay(lat, lon, distance) {
      latEl.textContent = lat.toFixed(4);
      lonEl.textContent = lon.toFixed(4);
      distEl.textContent = distance.toFixed(1);

      if (distance <= TRIGGER_RADIUS) {
        statusEl.innerHTML = '‚úì <b>In range!</b><br>Model visible';
        statusEl.style.color = '#0f0';
      } else {
        statusEl.innerHTML = `‚ö† ${(distance - TRIGGER_RADIUS).toFixed(0)}m away`;
        statusEl.style.color = '#fa0';
      }
    }

    // Start GPS tracking
    if (navigator.geolocation) {
      statusEl.innerHTML = 'üìç Getting location...';
      statusEl.style.color = '#aaf';

      navigator.geolocation.watchPosition(
        (pos) => {
          const dist = calculateDistance(pos.coords.latitude, pos.coords.longitude, TARGET_LAT, TARGET_LON);
          updateDisplay(pos.coords.latitude, pos.coords.longitude, dist);
        },
        (err) => {
          statusEl.innerHTML = '‚ùå GPS Error<br>' + err.message;
          statusEl.style.color = '#f44';
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
      );
    } else {
      statusEl.innerHTML = '‚ùå No GPS';
      statusEl.style.color = '#f44';
    }
  </script>
</body>
</html>
